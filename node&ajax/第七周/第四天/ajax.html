<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
    var getXHR= (function () {
        var list = [function () {
            return new XMLHttpRequest;
        }, function () {
            return new ActiveXObject('Microsoft.XMLHTTP');
        }, function () {
            return new ActiveXObject("Msxml2.XMLHTTP");
        }, function () {
            return new ActiveXObject("Msxml3.XMLHTTP");
        }];
        var len = list.length;
        var xhr = null;
        while (len--) {
            try {
                list[len]();
                xhr = list[len];
                break;
            } catch (ex) {
                continue;
            }
        }
        if (xhr !== null) {
            return xhr;
        }
        throw new Error('当前浏览器不支持此方法');
    })();


    //1、获得ajax对象
    var xhr=getXHR();

    //2、调用open方法，只是构造http request的报文，但是暂时还未发送
    /*
    * 第一个参数http方法
    * 第二个参数request url 请求的路径（请求的接口）
    * 第三个参数 是否为异步，默认为true
    * 第四个参数 username 默认为undefined
    * 第五个参数 password 默认为undefined
    * */
    //第三个参数为true或false是的区别
    xhr.open('get','http',true)

    //2.1 设置请求首部，首部是可以自定义，但是有兼容性 ie10+
    xhr.setRequestHeader('myname','zl');
    xhr.setRequestHeader('content-type','text/plain','charest=utf-8')

    //2.2 重写响应的mime类型 兼容新ie10+
    xhr.overrideMimeType('text/plain;charset=utf-8')
    
    //3、获取响应
    //每当ajax对象的readyState改变的时候，都会执行该方法
    xhr.onreadystatechange=function (){
        if(xhr.readyState===4&&/^2\d{2}$/.test(xhr.status)){
            //3.2、获取服务器响应首部，兼容性ie10+
            var GMT=xhr.getResponseHeader('Date');
            var data=new Date(GMT);

            console.log('服务器时间为',data.toLocaleString())
            
            //开始执行回调逻辑
            //获取服务器返回的数据->响应主体

            //1、把响应主体当成字符串显示
            console.log(xhr.responseText);
            //2、把响应主体当成xml显示
            console.log(xhr.responseXML);
            //3、直接获取响应主体，不进行转型,有兼容性 ie10+可以
            //responseType把response转换成指定格式
            //xhr.responseType='json'
            console.log(xhr.response);
        }else {
            console.log("wrong")
        }

    };

    //3.1 readyState
    //当前ajax对象的状态，执行到哪一步了
    //xhr.readyState 是一个枚举值
    /*
    * 0 UNSENT 默认值 表示ajax对象仅仅初始化完成
    * 1 OPENED 已结执行ajax对象open方法
    * 2 HEADERS_RECEIVED 接收到http响应首部
    * 3 LOADING 正在接收响应主体
    * 4 DONE 全部完成 http事务已经完成
    * */

    //设置超时
    //从http的request发送成功开始算起，规定毫秒内服务器没有给http响应，那么强制终止http事务
    xhr.timeout=3000;
    if(xhr.hasOwnProperty('ontimeout')){

        //超时执行的逻辑，在3000毫秒内，没有http的request就执行ontimeout方法
        xhr.ontimeout=function (){
            console.log('超时')
        };
    }else {
        setTimeout(function (){
        if(xhr.readyState!==4){
            //强制终止http事务
            xhr.abort();
        }
        },xhr.timeout)
    }
    


    //4、发送http请求
    /*
    * 参数类型 string fromdata blob arraybuffer null undefined
    * send方法会把参数传到请求体里，因为get系没有请求体，所以传参数无效。因此get系请求不需要传参数，如果是post系，则会把参数原封不动放到请求体里
    *
    * 
    * */
    xhr.send();


</script>

</body>
</html>